/*
 * DSTU.c
 *
 * Created: 12.09.2021 07:13:32
 *  Author: root
 */ 

#include "dstu_types.h"
#include "DSTU.h"
//#include "Curve.h"
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>
#include <inttypes.h>

uint8_t DSTUDefaultSBox[128] = {
	0x01, 0x02, 0x03, 0x0E, 0x06, 0x0D, 0x0B, 0x08, 0x0F, 0x0A, 0x0C, 0x05,
	0x07, 0x09, 0x00, 0x04, 0x03, 0x08, 0x0B, 0x05, 0x06, 0x04, 0x0E, 0x0A,
	0x02, 0x0C, 0x01, 0x07, 0x09, 0x0F, 0x0D, 0x00, 0x02, 0x08, 0x09, 0x07,
	0x05, 0x0F, 0x00, 0x0B, 0x0C, 0x01, 0x0D, 0x0E, 0x0A, 0x03, 0x06, 0x04,
	0x0F, 0x08, 0x0E, 0x09, 0x07, 0x02, 0x00, 0x0D, 0x0C, 0x06, 0x01, 0x05,
	0x0B, 0x04, 0x03, 0x0A, 0x03, 0x08, 0x0D, 0x09, 0x06, 0x0B, 0x0F, 0x00,
	0x02, 0x05, 0x0C, 0x0A, 0x04, 0x0E, 0x01, 0x07, 0x0F, 0x06, 0x05, 0x08,
	0x0E, 0x0B, 0x0A, 0x04, 0x0C, 0x00, 0x03, 0x07, 0x02, 0x09, 0x01, 0x0D,
	0x08, 0x00, 0x0C, 0x04, 0x09, 0x06, 0x07, 0x0B, 0x02, 0x03, 0x01, 0x0F,
	0x05, 0x0E, 0x0A, 0x0D, 0x0A, 0x09, 0x0D, 0x06, 0x0E, 0x0B, 0x04, 0x05,
	0x0F, 0x01, 0x03, 0x0C, 0x07, 0x00, 0x08, 0x02
};

size_t PackBox(uint8_t * input, size_t input_len, uint8_t * result) {
	result = malloc(input_len / 2);
	size_t rows = input_len & 0xf0;
	for (uint8_t idx = 0; idx < input_len; idx += 2)
	{
		size_t retIdx = (rows - 0x10 - (idx & 0xF0)) | (idx & 0x0F);
		result[retIdx >> 1] = (uint8_t)(input[idx] << 4 | input[idx + 1]);
	}
	return input_len / 2;
}